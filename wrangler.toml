# Cloudflare Workers/Pages configuration for ChittyChronicle

name = "chittychronicle"
compatibility_date = "2024-01-01"

# Production configuration
[env.production]
name = "chittychronicle"
routes = [
  { pattern = "chronicle.chitty.cc/*", zone_name = "chitty.cc" }
]

# Cloudflare Pages configuration
[build]
command = "npm run build"
build_output_directory = "dist/public"

# Environment variables (set these in Cloudflare dashboard)
[env.production.vars]
NODE_ENV = "production"

# Durable Objects for real-time features
[[env.production.durable_objects.bindings]]
name = "TIMELINE_STATE"
class_name = "TimelineState"

# KV namespaces for caching
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"

# D1 Database binding (if using Cloudflare D1 instead of external PostgreSQL)
[[env.production.d1_databases]]
binding = "DB"
database_name = "chittychronicle"
database_id = "your-d1-database-id"

# R2 bucket for file storage
[[env.production.r2_buckets]]
binding = "UPLOADS"
bucket_name = "chittychronicle-uploads"

# Preview/staging environment
[env.preview]
name = "chittychronicle-preview"
routes = [
  { pattern = "preview.chronicle.chitty.cc/*", zone_name = "chitty.cc" }
]

[env.preview.vars]
NODE_ENV = "staging"

# Development environment
[env.development]
name = "chittychronicle-dev"
vars = { NODE_ENV = "development" }

# Cloudflare Pages Functions (serverless API endpoints)
[functions]
directory = "functions"
includes = ["api/*"]
excludes = []

# Build configuration
[site]
bucket = "./dist/public"

# Deployment rules
[[deployments]]
environment = "production"
branch = "main"

[[deployments]]
environment = "preview"
branch = "develop"