# Cross-Source Message Merge Package

Complete implementation for merging communications from iMessage, WhatsApp, Email, DocuSign, and OpenPhone into a unified timeline using Neon PostgreSQL.

## Contents
- `database/schema/cross_source_merge_schema.sql`
- `database/schema/cross_source_merge_functions.sql`
- `database/schema/cross_source_queries.sql`
- `database/schema/cross_source_ingest.sql`
- `database/schema/openphone_ingest.sql`
- `sample_data/cross_source_timeline_v0_1.csv`
- `scripts/deploy-to-neon.sh`

## Quick Start

```bash
export DATABASE_URL='postgresql://user:pass@host.neon.tech/dbname?sslmode=require'

# Schema + views + functions
./scripts/deploy-to-neon.sh

# Include sample data
./scripts/deploy-to-neon.sh --with-sample-data

# Prepare OpenPhone adapter
./scripts/deploy-to-neon.sh --with-openphone
# Then import your CSV:
# psql "$DATABASE_URL" -c "\copy staging_openphone_messages FROM 'OpenPhone Data/ORuce0BjRH_messages.csv' WITH CSV HEADER"
# And re-run:
# psql "$DATABASE_URL" -f database/schema/openphone_ingest.sql
```

## Usage Examples

```sql
SELECT * FROM find_party_messages('nick@aribia.com');
SELECT * FROM find_party_messages('+13125361914');

SELECT * FROM search_messages('tenant breach', 'email', '2024-08-01', '2024-08-31');

SELECT * FROM generate_case_timeline('2024-01-01','2024-12-31', ARRAY['nick@aribia.com', '+13125361914']);

-- Export
COPY (SELECT * FROM v_unified_timeline) TO STDOUT WITH CSV HEADER;
```
